<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qst.dao.orderDao">

	<insert id="creatorder">
		insert into `order` (u_id,ordernumber) values (#{u_id},#{ordernumber});
	</insert>

	<insert id="creatorder_good" >
		insert into order_goods (ordernumber,g_id,prince,og_num)
		values(#{ordernumber},#{g_id},#{prince},#{og_num});
	</insert>

	<select id="getgid" parameterType="java.lang.Long" resultType="int">
		select g_id from order_goods where ordernumber=#{ordernumber};
	</select>

	<select id="getorder_goods" parameterType="java.lang.Long"
		resultType="OrderGoods">
		select * from order_goods where ordernumber=#{ordernumber};
	</select>

	<select id ="getgoods_item" resultType="Goods_item" >
		SELECT b.g_name as g_name,a.prince as prince ,a.og_num as og_num ,image_zhanshi FROM order_goods a, goods b WHERE a.ordernumber=#{ordernumber} AND b.g_id=#{g_id} AND b.g_id=a.g_id;
	</select>

	<select id="getSumprince" parameterType="java.lang.Long" resultType="float">
		SELECT SUM(prince*og_num) FROM order_goods where ordernumber=#{ordernumber};
	</select>
	<select id="getOrderByUser" resultType="java.util.HashMap">
		SELECT
			o.ordernumber AS id,
			o.pay_type AS payType,
			o.price AS price,
			o.status AS `status`,
			a.street AS street,
			a.region AS region,
			a.phone AS phone,
			a.name AS `name`
		FROM `order` o
		LEFT JOIN adress a ON o.ad_id = a.ad_id
		WHERE o.u_id=#{0}
	</select>
    <select id="countByUser" resultType="hashmap">
		SELECT
			count(*) AS n,u_id AS id
		FROM `order`
		GROUP BY u_id
	</select>

    <insert id="createOrder" >
		INSERT INTO `order` (u_id,ordernumber,price,ad_id,status)
		VALUES (#{0},#{1},#{2},#{3},1)
	</insert>
</mapper>