<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qst.dao.GoodsDao">
	<!-- select：查询操作；id：标识；parameterType：接收的参数类型，resultType：返回值类型 -->

	<!--通过商品id查找 所有商品详细信息 返回一个list集合 -->
	<select id="getGoods" parameterType="int" resultType="Goods">
		select *
		from goods where g_id=#{g_id};
	</select>

	<!--发布商平的,插入商品的信息,返回插入刚刚生成的id号 -->
	<insert id="releaseGood" parameterType="Goods" useGeneratedKeys="true" keyProperty="g_id">
		insert into
		goods(g_price,g_name,g_attribute,u_id,image_id,restnum,introduce,image_zhanshi,market_price,
		g_content)
		VALUES(#{g_price},#{g_name},#{g_attribute},#{u_id},#{image_id},#{restnum},#{introduce},#{image_zhanshi},#{market_price},#{g_content})
	</insert>

	<!--根据商品id进行查找 -->
	<select id="showGoods" parameterType="int" resultType="Goods">
		select *
		from goods where g_id=#{goodId};
	</select>


	<!--寻找图片地址的语句,用来显示到index界面parameterType="Page" -->
	<select id="indexShow" parameterType="Page" resultType="Goods">
		select * from goods
		<where>
			<if test="attribute != null and ''!= attribute">
				and g_attribute=#{attribute}
			</if>
			<if test="gname !=null and ''!= gname">
				and g_name like '%${gname}%'
			</if>
		</where>
		limit #{begin},#{limitPage};

	</select>

	<!--查找指定类型的商品数量，类型无则查询所有 -->
	<select id="findImageNum" parameterType="java.lang.String" resultType="int">
		select count(g_id) from goods
		<where>
			<if test="type!=null and ''!= type">
				and g_attribute=#{type}
			</if>

			<if test="gname!=''and gname!=null">
				and g_name like '%${gname}%'
			</if>
		</where>
	</select>


	<!--查找指定本用户的商品 -->
	<select id="releaseGoods" parameterType="Page" resultType="Goods">
		select * from goods
		where u_id=#{id}
		limit #{begin},#{limitPage};
	</select>

	<!--更新用户商品的数据 -->
	<update id="upadateReleaseGoods" parameterType="Goods">
		update goods set
		g_price=#{g_price},g_name=#{g_name},g_attribute=#{g_attribute},restnum=#{restnum},introduce=#{introduce},image_zhanshi=#{image_zhanshi},market_price=#{market_price},
		g_content=#{g_content} where g_id=#{g_id}
	</update>


	<!--查找指定本用户的商品数量 -->
	<select id="findReleaseGoodsNum" parameterType="int" resultType="int">
		select count(g_id) from goods where u_id=#{id}
	</select>


	<!--用户根据g_id删除他的发布商品 -->
	<delete id="deleteReleaseGood" parameterType="int">
		DELETE from goods where g_id=#{goodId}
	</delete>

	<!--展示所有的类型 -->
	<select id="showAllAttri" resultType="string">
		SELECT g_attribute from
		goods GROUP BY g_attribute
		ORDER BY g_id ASC
	</select>

	<!--显示所有的关于此商品的评价 -->
	<select id="showEvaluate" parameterType="int" resultMap="getSessionId">
		select *
		from goods_session where g_id=#{goodId}
	</select>
	<resultMap id="getSessionId" type="GoodsSession">
		<id column="g_id" property="g_id" />
		<association column="session_id" property="session" javaType="Session" select="getEvaluate">
		</association>
	</resultMap>
	<select id="getEvaluate" parameterType="int" resultType="Session">
		select *
		from session where session_id=#{session_id}
	</select>

	<!--查找评价该商品的所有用户信息 -->
	<select id="showUserInfo" parameterType="int" resultType="User">
		SELECT uid,username,u_image from usertable,(SELECT u_id from `session`,goods_session where g_id=1 AND
		`session`.session_id=goods_session.session_id)d
		WHERE d.u_id =usertable.uid
	</select>
</mapper>